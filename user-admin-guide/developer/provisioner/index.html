<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-27787617-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <title>Provisioner &mdash; Loom 0.9.5 Beta documentation</title>
    
    <link rel="stylesheet" href="../../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.9.5 Beta',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Loom 0.9.5 Beta documentation" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../../index.html">Loom 0.9.5 Beta documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <span class="target" id="plugin-reference"></span><div class="section" id="provisioner">
<h1>Provisioner<a class="headerlink" href="#provisioner" title="Permalink to this headline">¶</a></h1>
<p>The Loom Provisioner is the worker daemon of Loom.  At a high level, it simply performs tasks given to it by the Loom Server.  These are the tasks necessary to orchestrate cluster operations and may include provisioning nodes from cloud providers, installing/configuring software, or running custom commands.  Each instance of the provisioner polls for the next task in the queue, and handles it to completion.  A plugin framework is utilized to handle any task for extensibility.  The provisioners are lightweight and stateless, therefore many can be run in parallel.</p>
<div class="section" id="operational-model">
<h2>Operational Model<a class="headerlink" href="#operational-model" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>At a high-level, the Loom provisioner is responsible for the following:</dt>
<dd><ul class="first last simple">
<li>polling the Loom Server for tasks</li>
<li>executing the received task by invoking the appropriate task handler plugin</li>
<li>reporting back the results of the operation, including success/failure and any appropriate metadata needed.</li>
</ul>
</dd>
</dl>
<p>Each running Loom Provisioner instance will continually poll the Loom Server for tasks.  When a task is received, it consists of a JSON task definition.  This task definition contains all the information needed by the provisioner to carry out the task.</p>
<dl class="docutils">
<dt>Consider the typical scenario for provisioning a node on a cloud provider asynchronously</dt>
<dd><ol class="first last arabic simple">
<li>the node is requested with given attributes (size, OS, region, etc)</li>
<li>the provider accepts the request and returns an internal ID for the new node it is going to create</li>
<li>during creation, the requestor must continually poll for the new node&#8217;s status and public IP address using the internal ID</li>
<li>the requestor does some additional validation using the IP address, and declares success</li>
</ol>
</dd>
</dl>
<p>The internal provider ID obtained in step 2 is required input for step 3, and will be required again if we wish to delete this node.  Similarly, the IP address obtained in step 4 will be used in subsequent tasks.</p>
<p>The following diagram illustrates how this is implemented by the Loom Provisioner:</p>
<div class="align-center figure">
<img alt="Provisioner Operational Model" src="../../_images/provisioner_operational_model.png" />
</div>
<p>In the diagram above, the Provisioner first recieves a CREATE task that instructs it to request a node from a specific provider.  The task contains the all the necessary provider-specific options (truncated in the diagram for brevity).  The provisioner then executes the node create request through the provider API and receives the new node&#8217;s provider ID as a result.  Since this provider ID will be critical for future operations against this node, it must report it back to the Loom Server.  It does so by populating a &#8220;result&#8221; key-value hash in the task result JSON.  The Loom server will preserve these key-values in a &#8220;config&#8221; hash on all subsequent tasks for this node.  In the diagram, the subsequent &#8220;CONFIRM&#8221; task is given the provider-id for the node, and similarly it reports back the IP address obtained from the provider in this step.  The third task shown now includes all metadata discovered thus far about the node in the request: the provider-id and the ipaddress.  In this way, Loom is building up a persistent payload of metadata about a node which can be used by any subsequent task.</p>
<p>In addition to this payload of key-value pairs, Loom also automatically provides additional metadata regarding cluster layout.  For example, once the nodes of a cluster are established, Loom Server will include a &#8220;nodes&#8221; hash in the task JSON which contains the hostnames and IP addresses of every node in the cluster.  This can be readily used by any task requiring cluster information, for example configuring software on a node which needs a list of all peer nodes in the cluster.</p>
</div>
<div class="section" id="plugin-framework">
<h2>Plugin Framework<a class="headerlink" href="#plugin-framework" title="Permalink to this headline">¶</a></h2>
<p>One of the design goals of Loom is to be agnostic to the type of cluster being managed.  To achieve this, Loom Provisioner makes extensive use of a plugin framework.  Plugins allow Loom to provision the same cluster in different providers.  They also allow an enterprise to customize implementation of their cluster services, for example integrating with their own SCM system of choice.</p>
<p>A plugin is a self-contained program designed to perform a specific set of tasks.  Currently, Loom supports plugins written in Ruby.  Each plugin must have a name and a type.  The name uniquely identifies each plugin, while the type groups related plugins together.  The type also corresponds to the list of tasks the plugin is capable of handling.  For example, consider the following diagram:</p>
<div class="align-center figure">
<img alt="Provisioner Plugin Framework" src="../../_images/provisioner_plugin_framework.png" />
</div>
<p>The diagram shows two tasks being consumed by provisioners and the logic used to invoke the appropriate plugin.  When a task is received, the provisioner first determines from the taskName which type of plugin is required to handle the task.  In the first example, a CREATE taskName indicates the task must be handled by a Provider plugin.  Loom then checks the task JSON for the providertype field to determine which plugin to invoke.  In the second example, an INSTALL taskName indicates the task must be handled by an Automator plugin.  Loom then checks the task JSON for the service action type field to determine which plugin to invoke.</p>
<p>A plugin must provide a descriptor file in which it declares its name, type, and execution class.  Upon startup, the provisioner scans its own directories looking for these descriptor files.  Upon successful verification, the plugin is considered registered.</p>
<p>A plugin can contain any arbitrary data it needs to perform its tasks.  For example, a provider plugin may store api credentials locally, or a Chef plugin may keep a local repository of cookbooks.  This data can be packaged with and considered as part of the plugin.  Alternatively, a plugin may also specify certain configuration parameters that it expects to be filled in by the UI users.  For example, there are variances among cloud providers regarding the credentials needed to access their API.  Some require a password, some require a key on disk, etc.  Loom allows a plugin to specify the necessary configuration fields, so that an admin can simply fill in the values on the UI.  Then, when a task is recieved by that particular plugin, it will have the necessary key-value pairs it expects.</p>
<p>This plugin model is integral to supporting many providers and custom installation procedures.  It makes it easy to leverage existing provider plugins or community code as plugins within Loom.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/quickstart/index.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/admin/index.html">Administration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/user/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rest/index.html">Web Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/release-notes.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/glossary.html">Glossary</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../../index.html">Loom 0.9.5 Beta documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Continuuity Inc..
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
  </body>
</html>