<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-55081520-3']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <title>Hot-Hot : With Custom Replication &mdash; Coopr 0.9.8 Beta Documentation</title>
    
    <link rel="stylesheet" href="../../../_static/cdap.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.9.8 Beta',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../../_static/favicon.ico"/>
    <link rel="top" title="Coopr 0.9.8 Beta Documentation" href="../../../index.html" />
    <link rel="up" title="Multi-Datacenter High Availability" href="../multi-data-center-bcp.html" />
    <link rel="next" title="Administration Guide" href="../../admin/index.html" />
    <link rel="prev" title="Hot-Hot : Synchronous Database Cluster" href="../option1/index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">Index</a></li>
        <li class="right" >
          <a href="../../admin/index.html" title="Administration Guide"
             accesskey="N">Next</a> |</li>
        <li class="right" >
          <a href="../option1/index.html" title="Hot-Hot : Synchronous Database Cluster"
             accesskey="P">Previous</a> |</li>
        <li><a href="../../../index.html">Coopr 0.9.8 Beta Documentation</a> &raquo;</li>
          <li><a href="../../superadmin/index.html" >Super Admin Guide</a> &raquo;</li>
          <li><a href="../index.html" >Business Continuity Plan (BCP)</a> &raquo;</li>
          <li><a href="../multi-data-center-bcp.html" accesskey="U">Multi-Datacenter High Availability</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <span class="target" id="overview-multi-data-center-high-availability"></span><div class="section" id="hot-hot-with-custom-replication">
<span id="index-0"></span><h1>Hot-Hot : With Custom Replication<a class="headerlink" href="#hot-hot-with-custom-replication" title="Permalink to this headline">¶</a></h1>
<div class="align-center figure" id="custom-replication">
<img alt="Custom Replication Architecture Diagram" src="../../../_images/ha_custom.png" />
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Synchronous database cluster may turn out to be not optimal for large Coopr installations due to the amount of data that needs to be replicated across datacenters.
In such a case we have to consider an alternative solution where we use local databases in each datacenter with a custom data replication service.
This will allow for all datacenters to share the data, while reducing the need to replicate all the data in the database.</p>
<p>Since we will not be sharing a database across datacenters now, we&#8217;ll need to treat the data slightly differently than before.
The data will be divided into shards based on the cluster ID partitioning. Each shard will be exclusively assigned to an owner database in a datacenter.
Only Coopr Servers running locally will be able to write to such a shard. Any requests to update the clusters in a non-local shard will be routed to the Coopr Server running in the datacenter owning the shard.
This update strategy prevents write conflicts since any updates to a cluster can be done only in a single database.</p>
<p>The custom replication reduces replication overhead in two ways. First, it only replicates data upon completion of operations.
Second, it replicates minimal state information needed to restart any operations in progress during datacenter failure. Intermediate state change data will not be replicated.</p>
<p>Each shard is synchronously replicated locally to handle intra-datacenter failover, and also remotely to at least one other datacenter.
Reads/writes to local shard, which probably will be majority of operations done in a datacenter, will be optimal.
But writes to non-local shard will be slow as it has to be routed to another datacenter.</p>
<p>Since we currently do not replicate each state change across datacenters, users of a datacenter will have a delayed view of remote cluster state.
The replication implementation should try to make this delay as minimal as possible.</p>
</div>
<div class="section" id="failover">
<h2>Failover<a class="headerlink" href="#failover" title="Permalink to this headline">¶</a></h2>
<p>When a datacenter fails, the remote datacenters having the shards of the failed datacenter will become the new owners of the shards.
All calls to these shards will need to be routed to the new owner datacenters.</p>
<p>Also, since we replicate state information required to restart any operations, any in-progress jobs during datacenter failure
can be restarted by the new owner datacenter.
However, any transaction that was in progress when the datacenter failed will be lost as it was not committed.</p>
<p>User traffic from the failed datacenter will be re-routed to other datacenters automatically by the load balancer.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><!--
  ~ Copyright 2014 Cask Data, Inc.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License"); you may not
  ~ use this file except in compliance with the License. You may obtain a copy of
  ~ the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
  ~ WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
  ~ License for the specific language governing permissions and limitations under
  ~ the License.
  -->

<h3><a href="../../../index.html">Table of Contents</a></h3>
<nav>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart/index.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview/features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview/architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/index.html">Installation Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../superadmin/index.html">Super Admin Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../superadmin/overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../superadmin/tenants.html">Tenant Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../superadmin/callbacks.html">Cluster Callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../superadmin/plugins.html">Provisioner Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../superadmin/monitoring.html">Monitoring and Metrics</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Business Continuity Plan (BCP)</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../data-center-bcp.html">Datacenter High Availability</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../multi-data-center-bcp.html">Multi-Datacenter High Availability</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../option1/index.html">Hot-Hot : Synchronous Database Cluster</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="">Hot-Hot : With Custom Replication</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l5"><a class="reference internal" href="#failover">Failover</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../admin/index.html">Administration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rest/index.html">Web Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview/security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../implementation.html">Under the Hood</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faq/index.html">FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release-notes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../overview/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../javadocs/index.html">Javadocs</a></li>
</ul>

</nav>
  <h4>Previous Topic</h4>
  <p class="topless"><a href="../option1/index.html"
                        title="Previous Chapter">Hot-Hot : Synchronous Database Cluster</a></p>
  <h4>Next Topic</h4>
  <p class="topless"><a href="../../admin/index.html"
                        title="Next Chapter">Administration Guide</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick Search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >Index</a></li>
        <li class="right" >
          <a href="../../admin/index.html" title="Administration Guide"
             >Next</a> |</li>
        <li class="right" >
          <a href="../option1/index.html" title="Hot-Hot : Synchronous Database Cluster"
             >Previous</a> |</li>
        <li><a href="../../../index.html">Coopr 0.9.8 Beta Documentation</a> &raquo;</li>
          <li><a href="../../superadmin/index.html" >Super Admin Guide</a> &raquo;</li>
          <li><a href="../index.html" >Business Continuity Plan (BCP)</a> &raquo;</li>
          <li><a href="../multi-data-center-bcp.html" >Multi-Datacenter High Availability</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        Copyright &copy; 2014 Cask Data, Inc.
    </div>
  </body>
</html>