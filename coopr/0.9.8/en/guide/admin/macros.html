<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-55081520-3']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <title>Macros &mdash; Coopr 0.9.8 Beta Documentation</title>
    
    <link rel="stylesheet" href="../../_static/cdap.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.9.8 Beta',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="Coopr 0.9.8 Beta Documentation" href="../../index.html" />
    <link rel="up" title="Administration Guide" href="index.html" />
    <link rel="next" title="Plugin Resources" href="plugin-resources.html" />
    <link rel="prev" title="Administration User Interface" href="ui.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">Index</a></li>
        <li class="right" >
          <a href="plugin-resources.html" title="Plugin Resources"
             accesskey="N">Next</a> |</li>
        <li class="right" >
          <a href="ui.html" title="Administration User Interface"
             accesskey="P">Previous</a> |</li>
        <li><a href="../../index.html">Coopr 0.9.8 Beta Documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Administration Guide</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="macros">
<span id="index-0"></span><h1>Macros<a class="headerlink" href="#macros" title="Permalink to this headline">¶</a></h1>
<p>Often at template creation time, certain parameters cannot be set because their values are unknown or their values can
be only ascertained during runtime. For instance, at the time of configuring a cluster template, it is impossible to know the
hostnames or IP addresses of other nodes within a cluster. For this reason, Coopr supports several macros that allow administrators
to programmatically set these values ahead of time as place holders, which later can be substituted with actual values.</p>
<div class="section" id="basic-macros">
<h2>Basic Macros<a class="headerlink" href="#basic-macros" title="Permalink to this headline">¶</a></h2>
<p>Macros are supported in the config section of a template and are denoted by surrounding <tt class="docutils literal"><span class="pre">%</span></tt>
symbols or strings. Basic macros allow you to specify a comma delimited list of hostnames or IP addresses of nodes that provide a
specific service. The basic macros available are:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="o">%</span><span class="n">host</span><span class="o">.</span><span class="na">service</span><span class="o">.&lt;</span><span class="n">service</span> <span class="n">name</span><span class="o">&gt;%</span>
<span class="o">%</span><span class="n">host</span><span class="o">.</span><span class="na">self</span><span class="o">%</span>
<span class="o">%</span><span class="n">ip</span><span class="o">.</span><span class="na">service</span><span class="o">.&lt;</span><span class="n">service</span> <span class="n">name</span><span class="o">&gt;%</span>
<span class="o">%</span><span class="n">ip</span><span class="o">.&lt;</span><span class="n">ip</span> <span class="n">type</span><span class="o">&gt;.</span><span class="na">service</span><span class="o">.&lt;</span><span class="n">service</span> <span class="n">name</span><span class="o">&gt;%</span>
<span class="o">%</span><span class="n">ip</span><span class="o">.</span><span class="na">self</span><span class="o">%</span>
<span class="o">%</span><span class="n">ip</span><span class="o">.&lt;</span><span class="n">ip</span> <span class="n">type</span><span class="o">&gt;.</span><span class="na">self</span><span class="o">%</span>
<span class="o">%</span><span class="n">num</span><span class="o">.</span><span class="na">service</span><span class="o">.&lt;</span><span class="n">service</span> <span class="n">name</span><span class="o">&gt;%</span>
<span class="o">%</span><span class="n">cluster</span><span class="o">.</span><span class="na">owner</span><span class="o">%</span>
</pre></div>
</div>
<p>Basic macros return a comma separated list of the specified entity for all nodes that contain the specified service.
For example, &#8216;%host.service.datanode%&#8217; will be replaced with a comma separated list of all nodes in the cluster that
have the datanode service. &#8216;%cluster.owner%&#8217; will be replaced with the owner of the cluster. Since there can be multiple
types of IP addresses for a single node, IP macros support specifying the type of macro,
which is either &#8216;access_v4&#8217; or &#8216;bind_v4&#8217;. The &#8216;access_v4&#8217; IP address is the address used
to connect to the node from the outside world, whereas &#8216;bind_v4&#8217; is the address services on the node should bind to.
In most cases, configuration will use the bind_v4 address, so if no IP address type is given, the bind_v4 address
will be used.</p>
<p>The &#8216;%host.self%&#8217; macro will be replaced with the hostname of the node where the task is being executed. Similarly,
the &#8216;%ip.&lt;ip type&gt;.self%&#8217; and &#8216;%ip.self%&#8217; macros will be replaced with the corresponding ip address of the the node
where the task is being executed.</p>
</div>
<div class="section" id="basic-macro-instances">
<h2>Basic Macro Instances<a class="headerlink" href="#basic-macro-instances" title="Permalink to this headline">¶</a></h2>
<p>Basic macros refer to an entity for a group of nodes containing a specific service. Sometimes, it is
necessary to refer to an entity for a single node that contains a specific service.  This can be done with basic
macro instances:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="o">%</span><span class="n">instance</span><span class="o">.</span><span class="na">self</span><span class="o">.</span><span class="na">service</span><span class="o">.&lt;</span><span class="n">service</span> <span class="n">name</span><span class="o">&gt;%</span>
<span class="o">%</span><span class="n">host</span><span class="o">.</span><span class="na">service</span><span class="o">.&lt;</span><span class="n">service</span> <span class="n">name</span><span class="o">&gt;[</span><span class="n">instance</span> <span class="n">number</span><span class="o">]%</span>
<span class="o">%</span><span class="n">ip</span><span class="o">.</span><span class="na">service</span><span class="o">.&lt;</span><span class="n">service</span> <span class="n">name</span><span class="o">&gt;[</span><span class="n">instance</span> <span class="n">number</span><span class="o">]%</span>
<span class="o">%</span><span class="n">ip</span><span class="o">.&lt;</span><span class="n">ip</span> <span class="n">type</span><span class="o">&gt;.</span><span class="na">service</span><span class="o">.&lt;</span><span class="n">service</span> <span class="n">name</span><span class="o">&gt;[</span><span class="n">instance</span> <span class="n">number</span><span class="o">]%</span>
</pre></div>
</div>
<p>Instead of returning a comma separated list of hosts or ips, an instance macro returns a single value corresponding
to the entity of a single node that contains the specified service. For example, &#8216;%host.service.zookeeper[0]%&#8217; gets
replaced with the hostname of the first node that has the zookeeper service. Instance macros can also change depending on the node
that gets the config with the macros. For example, &#8216;%instance.self.service.zookeeper%&#8217; will get expanded to &#8216;1&#8217;
on the first node that has zookeeper, and expanded to &#8216;2&#8217; on the second node that has zookeeper and so on.</p>
</div>
<div class="section" id="macro-functions">
<h2>Macro Functions<a class="headerlink" href="#macro-functions" title="Permalink to this headline">¶</a></h2>
<p>Two macro functions are also supported in Coopr: join and map.</p>
<div class="highlight-java"><div class="highlight"><pre>%join(map(host.service.&lt;service name&gt;,&#39;&lt;format string&gt;&#39;),&#39;&lt;delimiter&gt;&#39;)%
%join(host.service.&lt;service name&gt;,&#39;&lt;delimiter&gt;&#39;)%
</pre></div>
</div>
<p>Join takes 2 arguments. The first argument is a basic macro or a map macro, and the second argument is a delimiter used to join them.
Map takes 2 arguments, the first argument is a basic macro and the second argument is a format string, where the format
gets applied to each entity in the basic macro. When the format is applied, the &#8216;$&#8217; character in the format string is
replaced by whatever value the entity resolves to.</p>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>Macros are best described with examples, and they are very common during installation, automation and configuration tasks.</p>
<p>Suppose you are configuring a HDFS + HBase cluster that uses three Zookeeper
nodes. A user creates a cluster from this template, and Coopr decides to place the namenode and
hbase-master services on a node with hostname <tt class="docutils literal"><span class="pre">hadoop-dev-1001.local</span></tt> and IP address <tt class="docutils literal"><span class="pre">123.456.0.1</span></tt>. It then decides to place
the three Zookeeper services on their own nodes with hostnames <tt class="docutils literal"><span class="pre">hadoop-dev-[1002-1004].local</span></tt> with IP addresses <tt class="docutils literal"><span class="pre">123.456.0.[2-4]</span></tt>.
One configuration setting each datanode needs is called <tt class="docutils literal"><span class="pre">fs.defaultFS</span></tt>, and it needs to be set to a value that contains
the hostname of the namenode. This can be achieved with the following basic macro:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="s">&quot;fs.defaultFS&quot;</span><span class="o">:</span><span class="s">&quot;hdfs://%host.service.hadoop-hdfs-namenode%&quot;</span>
</pre></div>
</div>
<p>Coopr will see the macro <tt class="docutils literal"><span class="pre">%host.service.hadoop-hdfs-namenode%</span></tt> and replace it with a comma separated list of all the hosts
that contain the <tt class="docutils literal"><span class="pre">hadoop-hdfs-namenode</span></tt> service. Since the namenode service is only installed on one node, it will become:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="s">&quot;fs.defaultFS&quot;</span><span class="o">:</span><span class="s">&quot;hdfs://hadoop-dev-1001.local&quot;</span>
</pre></div>
</div>
<p>Similarly, if we had used the <tt class="docutils literal"><span class="pre">%ip.service.hadoop-hdfs-namenode%</span></tt> macro instead, it would resolve to:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="s">&quot;fs.defaultFS&quot;</span><span class="o">:</span><span class="s">&quot;hdfs://123.456.0.1&quot;</span>
</pre></div>
</div>
<p>When configuring the HBase master, we need to specify a Zookeeper quorum and namespace.
In this case, we want to end up with:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">hbase</span><span class="o">.</span><span class="na">zookeeper</span><span class="o">.</span><span class="na">quorum</span><span class="s">&quot;:&quot;</span><span class="n">hadoop</span><span class="o">-</span><span class="n">dev</span><span class="o">-</span><span class="mi">1002</span><span class="o">.</span><span class="na">local</span><span class="o">:</span><span class="mi">2181</span><span class="o">,</span><span class="n">hadoop</span><span class="o">-</span><span class="n">dev</span><span class="o">-</span><span class="mi">1003</span><span class="o">.</span><span class="na">local</span><span class="o">:</span><span class="mi">2181</span><span class="o">,</span><span class="n">hadoop</span><span class="o">-</span><span class="n">dev</span><span class="o">-</span><span class="mi">1004</span><span class="o">.</span><span class="na">local</span><span class="o">:</span><span class="mi">2181</span><span class="o">/</span><span class="n">namespace</span>
</pre></div>
</div>
<p>This can be achieved with the <tt class="docutils literal"><span class="pre">join</span></tt> and <tt class="docutils literal"><span class="pre">map</span></tt> macro:</p>
<div class="highlight-java"><div class="highlight"><pre>hbase.zookeeper.quorum&quot;:&quot;%join(map(host.service.zookeeper-server,&#39;$:2181&#39;),&#39;,&#39;)%/namespace
</pre></div>
</div>
<p>Similarly, if we wanted IP addresses, we could have replaced <tt class="docutils literal"><span class="pre">host.service.zookeeper-server</span></tt> with <tt class="docutils literal"><span class="pre">ip.service.zookeeper-server</span></tt>.</p>
<p>Now, let&#8217;s look at the configuration for Zookeeper. Each Zookeeper configuration file needs the list of servers
and their hostnames. To be more specific, part of each config file needs to contain:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="n">server</span><span class="o">.</span><span class="mi">1</span><span class="o">=</span><span class="n">hadoop</span><span class="o">-</span><span class="n">dev</span><span class="o">-</span><span class="mi">1002</span><span class="o">.</span><span class="na">local</span><span class="o">:</span><span class="mi">2888</span><span class="o">:</span><span class="mi">3888</span>
<span class="n">server</span><span class="o">.</span><span class="mi">2</span><span class="o">=</span><span class="n">hadoop</span><span class="o">-</span><span class="n">dev</span><span class="o">-</span><span class="mi">1003</span><span class="o">.</span><span class="na">local</span><span class="o">:</span><span class="mi">2888</span><span class="o">:</span><span class="mi">3888</span>
<span class="n">server</span><span class="o">.</span><span class="mi">3</span><span class="o">=</span><span class="n">hadoop</span><span class="o">-</span><span class="n">dev</span><span class="o">-</span><span class="mi">1004</span><span class="o">.</span><span class="na">local</span><span class="o">:</span><span class="mi">2888</span><span class="o">:</span><span class="mi">3888</span>
</pre></div>
</div>
<p>To do this, we can use the following macros in the template configuration:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="s">&quot;server.1&quot;</span><span class="o">:</span><span class="s">&quot;%host.service.zookeeper-server[0]%:2888:3888&quot;</span>
<span class="s">&quot;server.2&quot;</span><span class="o">:</span><span class="s">&quot;%host.service.zookeeper-server[1]%:2888:3888&quot;</span>
<span class="s">&quot;server.3&quot;</span><span class="o">:</span><span class="s">&quot;%host.service.zookeeper-server[2]%:2888:3888&quot;</span>
</pre></div>
</div>
<p>These macros work just like the <tt class="docutils literal"><span class="pre">%host.service.zookeeper-server%</span></tt> macro, but rather than being replaced by a
comma-separated list of all hosts with the <tt class="docutils literal"><span class="pre">zookeeper-server</span></tt> service, it&#8217;s replaced by the hostname of the <em>i</em>&#8216;th
node with <tt class="docutils literal"><span class="pre">zookeeper-server</span></tt>, where <em>i</em> is specified in the square brackets.</p>
<p>Each Zookeeper service also needs to know its ID. Taking the above example, <tt class="docutils literal"><span class="pre">hadoop-dev-1002.local</span></tt> needs to know that
its ID is 1 (matching the <tt class="docutils literal"><span class="pre">server.1</span></tt> setting), <tt class="docutils literal"><span class="pre">hadoop-dev-1003.local</span></tt> needs to know that its ID is 2 (again matching
the <tt class="docutils literal"><span class="pre">server.2</span></tt> setting), and so on. To achieve this, we can use the self macro:</p>
<div class="highlight-java"><div class="highlight"><pre><span class="s">&quot;myId&quot;</span><span class="o">:</span><span class="s">&quot;%instance.self.service.zookeeper-server%&quot;</span>
</pre></div>
</div>
<p>This variable will be replaced by the instance number of that service, beginning at 1. To be exact,
<tt class="docutils literal"><span class="pre">hadoop-dev-1002.local</span></tt> will receive <tt class="docutils literal"><span class="pre">&quot;myId&quot;:&quot;1&quot;</span></tt>, <tt class="docutils literal"><span class="pre">hadoop-dev-1003.local</span></tt> will receive <tt class="docutils literal"><span class="pre">&quot;myId&quot;:&quot;2&quot;</span></tt>, and
<tt class="docutils literal"><span class="pre">hadoop-dev-1004.local</span></tt> will receive <tt class="docutils literal"><span class="pre">&quot;myId:3&quot;</span></tt>. Similarly, if a node needs its own hostname or IP address, you can use
<tt class="docutils literal"><span class="pre">%host.self.service.[service</span> <span class="pre">name]%</span></tt> and <tt class="docutils literal"><span class="pre">%ip.self.service.[service</span> <span class="pre">name]%</span></tt>, respectively. Finally, say if you need a
configuration setting that needs to resolve to the number of zookeeper-servers running in your cluster. This
can be achieved with the <tt class="docutils literal"><span class="pre">%num.service.zookeeper-server%</span></tt> macro.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><!--
  ~ Copyright 2014 Cask Data, Inc.
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License"); you may not
  ~ use this file except in compliance with the License. You may obtain a copy of
  ~ the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
  ~ WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
  ~ License for the specific language governing permissions and limitations under
  ~ the License.
  -->

<h3><a href="../../index.html">Table of Contents</a></h3>
<nav>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/index.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../superadmin/index.html">Super Admin Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Administration Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="ui.html">Administration User Interface</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Macros</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#basic-macros">Basic Macros</a></li>
<li class="toctree-l3"><a class="reference internal" href="#basic-macro-instances">Basic Macro Instances</a></li>
<li class="toctree-l3"><a class="reference internal" href="#macro-functions">Macro Functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="plugin-resources.html">Plugin Resources</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rest/index.html">Web Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../implementation.html">Under the Hood</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">FAQs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release-notes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../javadocs/index.html">Javadocs</a></li>
</ul>

</nav>
  <h4>Previous Topic</h4>
  <p class="topless"><a href="ui.html"
                        title="Previous Chapter">Administration User Interface</a></p>
  <h4>Next Topic</h4>
  <p class="topless"><a href="plugin-resources.html"
                        title="Next Chapter">Plugin Resources</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick Search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >Index</a></li>
        <li class="right" >
          <a href="plugin-resources.html" title="Plugin Resources"
             >Next</a> |</li>
        <li class="right" >
          <a href="ui.html" title="Administration User Interface"
             >Previous</a> |</li>
        <li><a href="../../index.html">Coopr 0.9.8 Beta Documentation</a> &raquo;</li>
          <li><a href="index.html" >Administration Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        Copyright &copy; 2014 Cask Data, Inc.
    </div>
  </body>
</html>